#!/usr/bin/python3
import os, sys, argparse
from ver_utils import *

parser = argparse.ArgumentParser(description=__doc__)
parser.add_argument('remote')
parser.add_argument('--name', default="")
parser.add_argument('--debug', action="store_true")
args = parser.parse_args()

print ("ver -- Versioning Easily Remembered")

git("clone %s %s" % (args.remote, args.name), show=True, debug=args.debug)

if args.name:
    branch = args.name
else:
    if args.remote[-1] == "/":
        branch = args.remote[:-1]
    j = branch.rfind("/")
    branch = branch[j+1:]

os.chdir(branch)
f = open(".ver_root", "w")
f.write("This represents the root ver project. Please only have one in the path!")
f.close()

git("submodule update --init", show=args.debug, debug=args.debug)

subs = get_subs()
for sub in subs:
    path = os.path.abspath(".")
    os.chdir(sub[0])
    git("checkout master", show=args.debug, debug=args.debug)

cmd = ["ver-update", "--yes"]
if args.debug:
    cmd.append("--debug")
if args.debug:
    print(cmd)
run(cmd, showoutput=True)